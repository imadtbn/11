<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>لوحة تحكم — متجر المواد الغذائية السلام</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    :root{
      --primary:#2e7d32;--primary-dark:#1b5e20;--muted:#6b6b6b;--bg:#f5f6f4;--card:#fff;--radius:10px;--border:#e6e6e6;
      --danger:#c62828;--accent:#81c784;
      font-family: "Tajawal", Arial, sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;padding:0;background:#f0f2f5;color:#222;direction:rtl}
    .app{display:flex;min-height:100vh}

    /* SIDEBAR */
    .sidebar{width:250px;background:linear-gradient(180deg,var(--primary),var(--primary-dark));color:#fff;padding:18px;flex-shrink:0}
    .logo{display:flex;align-items:center;gap:10px;margin-bottom:18px}
    .logo i{font-size:26px}
    .nav{list-style:none;padding:0;margin:0}
    .nav li{display:flex;align-items:center;gap:12px;padding:12px;border-radius:8px;cursor:pointer}
    .nav li i{width:22px;text-align:center}
    .nav li.active{background:rgba(255,255,255,0.08);border-left:4px solid rgba(255,255,255,0.2)}

    /* MAIN */
    .main{flex:1;padding:20px;overflow:auto}
    .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
    .header h1{margin:0;font-size:20px;color:var(--primary-dark)}
    .card{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow:0 6px 18px rgba(0,0,0,0.05);margin-bottom:16px}

    /* GRID */
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px}

    /* FORMS */
    label{display:block;margin-bottom:6px;color:var(--primary-dark);font-weight:600}
    input[type=text],input[type=number],input[type=url],select,textarea,input[type=date]{width:100%;padding:10px;border:1px solid var(--border);border-radius:8px}
    .form-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
    .btn{display:inline-block;padding:10px 14px;border-radius:8px;border:0;cursor:pointer}
    .btn-primary{background:var(--primary);color:#fff}
    .btn-secondary{background:#f2f2f2;color:var(--muted)}
    .btn-danger{background:var(--danger);color:#fff}

    /* TABLE */
    table{width:100%;border-collapse:collapse}
    th,td{padding:12px;border-bottom:1px solid var(--border);text-align:right}
    th{background:#fafafa;color:var(--muted);font-weight:700}
    .actions{display:flex;gap:8px}
    .badge{padding:6px 10px;border-radius:20px;font-size:13px}

    /* small screens */
    @media (max-width:900px){.sidebar{display:none}.main{padding:12px}}

    /* loading overlay */
    .loading-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.35);display:flex;align-items:center;justify-content:center;z-index:9999;display:none}
    .loading-box{background:var(--primary);color:#fff;padding:14px;border-radius:8px;display:flex;gap:10px;align-items:center}

  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar" role="navigation">
      <div class="logo"><i class="fas fa-seedling"></i><div>
        <div style="font-weight:700">متجر المواد الغذائية السلام</div>
        <div style="font-size:12px;opacity:.9">لوحة التحكم</div>
      </div></div>
      <ul class="nav" id="navList">
        <li class="active" data-target="dashboard"><i class="fas fa-home"></i><span>لوحة التحكم</span></li>
        <li data-target="products"><i class="fas fa-box"></i><span>المنتجات</span></li>
        <li data-target="categories"><i class="fas fa-tags"></i><span>الأصناف</span></li>
        <li data-target="orders"><i class="fas fa-shopping-cart"></i><span>الطلبات</span></li>
        <li data-target="reports"><i class="fas fa-chart-line"></i><span>التقارير</span></li>
        <li data-target="settings"><i class="fas fa-cog"></i><span>الإعدادات</span></li>
      </ul>
    </aside>

    <main class="main">
      <div class="header">
        <h1 id="pageTitle">لوحة التحكم</h1>
        <div style="display:flex;gap:10px;align-items:center">
          <div style="font-size:14px;color:var(--muted)">مرحباً، المدير</div>
        </div>
      </div>

      <!-- DASHBOARD -->
      <section id="dashboard" class="page">
        <div class="grid">
          <div class="card">
            <div style="font-size:14px;color:var(--muted)">إجمالي المنتجات</div>
            <div style="font-size:24px;font-weight:700" id="statProducts">—</div>
          </div>
          <div class="card">
            <div style="font-size:14px;color:var(--muted)">عدد الطلبات</div>
            <div style="font-size:24px;font-weight:700" id="statOrders">—</div>
          </div>
          <div class="card">
            <div style="font-size:14px;color:var(--muted)">إجمالي الإيرادات</div>
            <div style="font-size:24px;font-weight:700" id="statRevenue">— دج</div>
          </div>
          <div class="card">
            <div style="font-size:14px;color:var(--muted)">الأصناف</div>
            <div style="font-size:24px;font-weight:700" id="statCategories">—</div>
          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <h3 style="margin:0 0 8px 0">الطلبات الأخيرة</h3>
          <div style="overflow:auto">
            <table aria-live="polite">
              <thead><tr><th>رقم</th><th>العميل</th><th>التاريخ</th><th>المبلغ</th><th>الحالة</th></tr></thead>
              <tbody id="recentOrdersBody"><tr><td colspan="5" style="text-align:center;padding:18px">لا توجد بيانات</td></tr></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- PRODUCTS -->
      <section id="products" class="page" style="display:none">
        <div class="card">
          <h3>إضافة / تحرير منتج</h3>
          <form id="productForm">
            <input type="hidden" id="productId">
            <div class="form-row" style="margin-top:12px">
              <div>
                <label for="productName">اسم المنتج</label>
                <input id="productName" type="text" required>
              </div>
              <div>
                <label for="productCategory">الصنف</label>
                <select id="productCategory"><option value="">---</option></select>
              </div>
            </div>

            <div class="form-row" style="margin-top:12px">
              <div>
                <label for="productPrice">السعر (دج)</label>
                <input id="productPrice" type="number" min="0" step="0.01">
              </div>
              <div>
                <label for="productStock">الكمية</label>
                <input id="productStock" type="number" min="0">
              </div>
            </div>

            <div style="margin-top:12px">
              <label for="productImage">رابط الصورة</label>
              <input id="productImage" type="url">
            </div>

            <div style="margin-top:12px">
              <label for="productDescription">الوصف</label>
              <textarea id="productDescription" rows="3"></textarea>
            </div>

            <div style="margin-top:12px;display:flex;gap:8px">
              <button class="btn btn-primary" type="submit">حفظ المنتج</button>
              <button class="btn btn-secondary" type="button" id="resetProduct">إلغاء</button>
            </div>
          </form>
        </div>

        <div class="card" style="margin-top:12px">
          <h3>قائمة المنتجات</h3>
          <div style="margin:10px 0;display:flex;justify-content:space-between;align-items:center">
            <input id="productSearch" placeholder="ابحث..." style="width:280px;padding:8px;border:1px solid var(--border);border-radius:8px">
            <div>
              <button class="btn btn-danger" id="deleteSelected">حذف المحدد</button>
            </div>
          </div>
          <div style="overflow:auto">
            <table>
              <thead><tr><th></th><th>الاسم</th><th>الصنف</th><th>السعر</th><th>المخزون</th><th>إجراءات</th></tr></thead>
              <tbody id="productsTable"><tr><td colspan="6" style="text-align:center;padding:18px">لا توجد منتجات</td></tr></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- CATEGORIES -->
      <section id="categories" class="page" style="display:none">
        <div class="card">
          <h3>إضافة صنف</h3>
          <form id="categoryForm">
            <input type="hidden" id="categoryId">
            <div style="margin-top:12px">
              <label for="categoryName">اسم الصنف</label>
              <input id="categoryName" type="text" required>
            </div>
            <div style="margin-top:12px;display:flex;gap:8px">
              <button class="btn btn-primary" type="submit">حفظ الصنف</button>
              <button class="btn btn-secondary" type="button" id="resetCategory">إلغاء</button>
            </div>
          </form>
        </div>

        <div class="card" style="margin-top:12px">
          <h3>قائمة الأصناف</h3>
          <div style="overflow:auto">
            <table>
              <thead><tr><th>الاسم</th><th>الوصف</th><th>إجراءات</th></tr></thead>
              <tbody id="categoriesTable"><tr><td colspan="3" style="text-align:center;padding:18px">لا توجد أصناف</td></tr></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- ORDERS -->
      <section id="orders" class="page" style="display:none">
        <div class="card">
          <h3>الطلبات</h3>
          <div style="margin:10px 0;display:flex;gap:8px;align-items:center">
            <select id="orderStatusFilter"><option value="">كل الحالات</option><option>جديد</option><option>قيد المعالجة</option><option>مكتمل</option><option>ملغى</option></select>
            <button class="btn btn-primary" id="applyOrderFilter">تطبيق</button>
          </div>
          <div style="overflow:auto">
            <table>
              <thead><tr><th>رقم</th><th>العميل</th><th>الهاتف</th><th>التاريخ</th><th>المبلغ</th><th>الحالة</th><th>إجراءات</th></tr></thead>
              <tbody id="ordersTable"><tr><td colspan="7" style="text-align:center;padding:18px">لا توجد طلبات</td></tr></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- REPORTS -->
      <section id="reports" class="page" style="display:none">
        <div class="card">
          <h3>تقارير</h3>
          <div id="reportsContent">لا توجد بيانات للعرض</div>
        </div>
      </section>

      <!-- SETTINGS -->
      <section id="settings" class="page" style="display:none">
        <div class="card">
          <h3>الإعدادات</h3>
          <div style="margin-top:12px">قم بوضع عنوان Google Apps Script API الخاص بك أدناه.</div>
          <div style="margin-top:12px;display:flex;gap:8px">
            <input id="apiUrlInput" placeholder="API_URL (مثال: https://script.google.com/macros/XXXXX/exec)" style="flex:1;padding:8px;border:1px solid var(--border);border-radius:8px">
            <button class="btn btn-primary" id="saveApiBtn">حفظ</button>
          </div>
        </div>
      </section>

      <footer style="margin-top:14px;text-align:center;color:var(--muted);font-size:13px">جميع الحقوق محفوظة © متجر المواد الغذائية السلام</footer>
    </main>
  </div>

  <div class="loading-overlay" id="loading" aria-hidden="true"><div class="loading-box"><span class="fas fa-spinner fa-spin"></span><div id="loadingText">جارٍ...</div></div></div>

  <script>
    // --------- CONFIG ---------
    // ضع رابط ال Google Apps Script هنا أو من صفحة الإعدادات
    let API_URL = localStorage.getItem('https://script.google.com/macros/s/AKfycbyWnp8P5YlY5UtWCvKTzwlxlbzX-I5BDoqOkIK1M5Kp_lIWdzZvMrzuM5-ko6SMTOf3IA/exec') || '';

    // --------- STATE ---------
    let products = [];
    let categories = [];
    let orders = [];

    // --------- UTIL ---------
    function showLoading(text='جارٍ...'){document.getElementById('loadingText').textContent=text;document.getElementById('loading').style.display='flex'}
    function hideLoading(){document.getElementById('loading').style.display='none'}
    function showAlert(msg){alert(msg)}

    // --------- NAVIGATION ---------
    document.getElementById('navList').addEventListener('click', function(e){
      const li = e.target.closest('li'); if(!li) return; document.querySelectorAll('.nav li').forEach(x=>x.classList.remove('active')); li.classList.add('active');
      const target = li.dataset.target; document.querySelectorAll('.page').forEach(p=>p.style.display='none'); document.getElementById(target).style.display='block';
      document.getElementById('pageTitle').textContent = li.innerText.trim();
      // load relevant data lazily
      if(target==='dashboard') loadDashboard();
      if(target==='products') loadProducts();
      if(target==='categories') loadCategories();
      if(target==='orders') loadOrders();
    });

    // --------- API WRAPPERS ---------
    async function apiGet(sheet){
      if(!API_URL){throw new Error('API_URL not set');}
      const res = await fetch(`${API_URL}?sheet=${encodeURIComponent(sheet)}`);
      if(!res.ok) throw new Error('شبكة');
      return await res.json();
    }
    async function apiPost(payload){
      if(!API_URL) throw new Error('API_URL not set');
      const res = await fetch(API_URL, {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
      if(!res.ok) throw new Error('تعذر الاتصال');
      return await res.json();
    }

    // --------- LOADERS ---------
    async function loadDashboard(){
      try{showLoading('تحميل بيانات اللوحة...');
        [products,orders,categories] = await Promise.all([apiGet('products'),apiGet('orders'),apiGet('categories')].map(p=>p.catch(()=>[])));
        document.getElementById('statProducts').textContent = products.length || 0;
        document.getElementById('statOrders').textContent = orders.length || 0;
        const revenue = (orders||[]).reduce((s,o)=>s + parseFloat(o.total||0),0);
        document.getElementById('statRevenue').textContent = revenue.toLocaleString() + ' دج';
        document.getElementById('statCategories').textContent = categories.length||0;
        renderRecentOrders();
      }catch(err){console.error(err);showAlert('خطأ في تحميل لوحة التحكم: '+err.message)}finally{hideLoading()}
    }

    async function loadProducts(){
      try{showLoading('تحميل المنتجات...'); products = await apiGet('products'); renderProductsTable(); populateCategorySelect();}catch(err){console.error(err);showAlert('خطأ في تحميل المنتجات: '+err.message)}finally{hideLoading()}
    }
    async function loadCategories(){
      try{showLoading('تحميل الأصناف...'); categories = await apiGet('categories'); renderCategoriesTable(); populateCategorySelect();}catch(err){console.error(err);showAlert('خطأ في تحميل الأصناف: '+err.message)}finally{hideLoading()}
    }
    async function loadOrders(){
      try{showLoading('تحميل الطلبات...'); orders = await apiGet('orders'); renderOrdersTable();}catch(err){console.error(err);showAlert('خطأ في تحميل الطلبات: '+err.message)}finally{hideLoading()}
    }

    // --------- RENDERS ---------
    function renderRecentOrders(){const tbody=document.getElementById('recentOrdersBody'); tbody.innerHTML='';if(!orders.length){tbody.innerHTML='<tr><td colspan="5" style="text-align:center;padding:18px">لا توجد طلبات</td></tr>';return} orders.slice(-6).reverse().forEach(o=>{const tr=document.createElement('tr'); tr.innerHTML=`<td>#${o.id||o.orderId||''}</td><td>${o.customerName||'-'}</td><td>${o.date||'-'}</td><td>${o.total||0} دج</td><td>${o.status||'—'}</td>`;tbody.appendChild(tr)})}

    function renderProductsTable(){const tbody=document.getElementById('productsTable'); tbody.innerHTML=''; if(!products.length){tbody.innerHTML='<tr><td colspan="6" style="text-align:center;padding:18px">لا توجد منتجات</td></tr>';return} products.forEach(p=>{const tr=document.createElement('tr'); tr.innerHTML=`<td><input type="checkbox" data-id="${p.id || ''}"></td><td>${escapeHtml(p.name||'')}</td><td>${escapeHtml(p.category||'')}</td><td>${p.price||0} دج</td><td>${p.stock||0}</td><td class="actions"><button class="btn btn-secondary" data-edit="${p.id||''}"><i class="fas fa-edit"></i></button><button class="btn btn-danger" data-delete="${p.id||''}"><i class="fas fa-trash"></i></button></td>`; tbody.appendChild(tr) }) }

    function renderCategoriesTable(){const tbody=document.getElementById('categoriesTable'); tbody.innerHTML=''; if(!categories.length){tbody.innerHTML='<tr><td colspan="3" style="text-align:center;padding:18px">لا توجد أصناف</td></tr>';return} categories.forEach(c=>{const tr=document.createElement('tr'); tr.innerHTML=`<td>${escapeHtml(c.name||'')}</td><td>${escapeHtml(c.description||'')}</td><td class="actions"><button class="btn btn-secondary" data-edit-cat="${c.id||''}"><i class="fas fa-edit"></i></button><button class="btn btn-danger" data-delete-cat="${c.id||''}"><i class="fas fa-trash"></i></button></td>`;tbody.appendChild(tr)})}

    function renderOrdersTable(){const tbody=document.getElementById('ordersTable'); tbody.innerHTML=''; if(!orders.length){tbody.innerHTML='<tr><td colspan="7" style="text-align:center;padding:18px">لا توجد طلبات</td></tr>';return} orders.forEach(o=>{const tr=document.createElement('tr'); tr.innerHTML=`<td>#${o.id||o.orderId||''}</td><td>${escapeHtml(o.customerName||'')}</td><td>${escapeHtml(o.phone||'')}</td><td>${escapeHtml(o.date||'')}</td><td>${o.total||0} دج</td><td>${o.status||''}</td><td class="actions"><button class="btn btn-secondary" data-view="${o.id||''}"><i class="fas fa-eye"></i></button></td>`;tbody.appendChild(tr)})}

    function populateCategorySelect(){const sel=document.getElementById('productCategory'); if(!sel) return; sel.innerHTML='<option value="">---</option>'; categories.forEach(c=>{const opt=document.createElement('option');opt.value=c.name;opt.textContent=c.name;sel.appendChild(opt)})}

    // --------- FORM HANDLERS ---------
    document.getElementById('productForm').addEventListener('submit', async function(e){e.preventDefault();const id=document.getElementById('productId').value; const payload={ action: id? 'updateProduct':'addProduct', product: { id: id||`prod_${Date.now()}`, name:document.getElementById('productName').value || '', category:document.getElementById('productCategory').value||'', price:document.getElementById('productPrice').value||0, stock:document.getElementById('productStock').value||0, image:document.getElementById('productImage').value||'', description:document.getElementById('productDescription').value||'', dateAdded:new Date().toISOString().split('T')[0] } }
      try{showLoading('حفظ المنتج...'); const res=await apiPost(payload); if(res && res.success){showAlert('تم الحفظ بنجاح'); resetProductForm(); loadProducts(); }else{showAlert('فشل في حفظ المنتج')} }catch(err){console.error(err);showAlert('خطأ: '+err.message)}finally{hideLoading()} })

    document.getElementById('resetProduct').addEventListener('click', resetProductForm);
    function resetProductForm(){document.getElementById('productId').value='';document.getElementById('productForm').reset();}

    document.getElementById('categoryForm').addEventListener('submit', async function(e){e.preventDefault(); const id=document.getElementById('categoryId').value; const payload={action:id? 'updateCategory':'addCategory', category:{id:id||`cat_${Date.now()}`, name:document.getElementById('categoryName').value||'', description:''}}; try{showLoading('حفظ الصنف...'); const res=await apiPost(payload); if(res && res.success){showAlert('تم حفظ الصنف'); resetCategoryForm(); loadCategories(); }else showAlert('فشل في حفظ الصنف'); }catch(err){console.error(err);showAlert('خطأ: '+err.message)}finally{hideLoading()} })
    document.getElementById('resetCategory').addEventListener('click', resetCategoryForm);
    function resetCategoryForm(){document.getElementById('categoryId').value='';document.getElementById('categoryForm').reset();}

    // delegate product actions (edit/delete/select)
    document.addEventListener('click', async function(e){
      if(e.target.closest('[data-edit]')){ const id=e.target.closest('[data-edit]').dataset.edit; const p=products.find(x=>x.id==id); if(!p) return; document.getElementById('productId').value=p.id; document.getElementById('productName').value=p.name; document.getElementById('productCategory').value=p.category; document.getElementById('productPrice').value=p.price; document.getElementById('productStock').value=p.stock; document.getElementById('productImage').value=p.image||''; document.getElementById('productDescription').value=p.description||''; window.scrollTo({top:0,behavior:'smooth'}); }
      if(e.target.closest('[data-delete]')){ const id=e.target.closest('[data-delete]').dataset.delete; if(!confirm('هل تريد حذف المنتج؟')) return; try{showLoading('حذف...'); const res=await apiPost({action:'deleteProduct', id}); if(res && res.success){showAlert('تم الحذف'); loadProducts(); }else showAlert('فشل في الحذف'); }catch(err){console.error(err);showAlert('خطأ: '+err.message)}finally{hideLoading()} }
      if(e.target.closest('[data-edit-cat]')){ const id=e.target.closest('[data-edit-cat]').dataset.editCat; const c=categories.find(x=>x.id==id); if(!c) return; document.getElementById('categoryId').value=c.id; document.getElementById('categoryName').value=c.name; window.scrollTo({top:0,behavior:'smooth'}); }
      if(e.target.closest('[data-delete-cat]')){ const id=e.target.closest('[data-delete-cat]').dataset.deleteCat; if(!confirm('هل تريد حذف الصنف؟')) return; try{showLoading('حذف الصنف...'); const res=await apiPost({action:'deleteCategory', id}); if(res && res.success){showAlert('تم الحذف'); loadCategories(); }else showAlert('فشل'); }catch(err){console.error(err);showAlert('خطأ: '+err.message)}finally{hideLoading()} }
      if(e.target.closest('[data-view]')){ const id=e.target.closest('[data-view]').dataset.view; const o=orders.find(x=>x.id==id || x.orderId==id); if(!o) return; // يمكن فتح نافذة تفاصيل أو modal
        alert(JSON.stringify(o,null,2)); }
    })

    // bulk delete selected
    document.getElementById('deleteSelected').addEventListener('click', async function(){ const checks=[...document.querySelectorAll('#productsTable input[type=checkbox]:checked')].map(i=>i.dataset.id).filter(Boolean); if(!checks.length) return showAlert('اختر منتجات أولاً'); if(!confirm('حذف '+checks.length+' منتج؟')) return; try{showLoading('حذف العناصر...'); const res=await apiPost({action:'bulkDeleteProducts', ids:checks}); if(res && res.success){showAlert('تم الحذف'); loadProducts(); }else showAlert('فشل'); }catch(err){console.error(err);showAlert('خطأ: '+err.message)}finally{hideLoading()} })

    // order filter
    document.getElementById('applyOrderFilter').addEventListener('click', function(){ const status=document.getElementById('orderStatusFilter').value; if(!status){ renderOrdersTable(); return;} const filtered=orders.filter(o=>o.status===status); const tbody=document.getElementById('ordersTable'); tbody.innerHTML=''; if(!filtered.length){tbody.innerHTML='<tr><td colspan="7" style="text-align:center;padding:18px">لا توجد طلبات</td></tr>';return} filtered.forEach(o=>{const tr=document.createElement('tr');tr.innerHTML=`<td>#${o.id||o.orderId||''}</td><td>${escapeHtml(o.customerName||'')}</td><td>${escapeHtml(o.phone||'')}</td><td>${escapeHtml(o.date||'')}</td><td>${o.total||0} دج</td><td>${o.status||''}</td><td class="actions"><button class="btn btn-secondary" data-view="${o.id||''}"><i class="fas fa-eye"></i></button></td>`;tbody.appendChild(tr)}) })

    // settings save API
    document.getElementById('saveApiBtn').addEventListener('click', function(){ const v=document.getElementById('apiUrlInput').value.trim(); if(!v) return showAlert('أدخل رابط API'); API_URL=v; localStorage.setItem('admin_api_url',v); showAlert('تم حفظ API_URL'); })

    // helpers
    function escapeHtml(t){ if(!t) return ''; return String(t).replace(/[&<>"']/g,function(c){return{'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]}) }

    // init
    (function init(){
      // show API if saved
      if(API_URL) document.getElementById('apiUrlInput').value = API_URL;
      // initial load
      loadDashboard();
      // search products
      document.getElementById('productSearch').addEventListener('input', function(){ const q=this.value.toLowerCase(); const filtered = products.filter(p=> (p.name||'').toLowerCase().includes(q)); const tbody=document.getElementById('productsTable'); tbody.innerHTML=''; if(!filtered.length){tbody.innerHTML='<tr><td colspan="6" style="text-align:center;padding:18px">لا توجد منتجات</td></tr>';return} filtered.forEach(p=>{const tr=document.createElement('tr');tr.innerHTML=`<td><input type="checkbox" data-id="${p.id||''}"></td><td>${escapeHtml(p.name||'')}</td><td>${escapeHtml(p.category||'')}</td><td>${p.price||0} دج</td><td>${p.stock||0}</td><td class="actions"><button class="btn btn-secondary" data-edit="${p.id||''}"><i class="fas fa-edit"></i></button><button class="btn btn-danger" data-delete="${p.id||''}"><i class="fas fa-trash"></i></button></td>`;tbody.appendChild(tr) }) })
    })();

  </script>
</body>
</html>
